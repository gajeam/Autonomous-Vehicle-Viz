<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <script src="http://d3js.org/d3.v3.min.js"></script>
    </head>
    <body>
        <h1>Autonomous Vehicles</h1>
        <div id="svgCanvas"></div>

        <script type="text/javascript">
        
        /* CONSTANTS */

        width = 700.0;
        height = 700.0;
        
        companyWidth = width / 8.0;
        companyHeight = height / 8.0;
        companyColor = "#32CD32";

        startupRadius = width / 15.0;
        startupColor = "#4682B4";

        personRadius = width / 50.0;
        personColor = "#D3D3D3";

        unit = ""

         /* CANVAS SETUP */

        svg = d3.select("#svgCanvas")
                .append("svg")
                .attr("width", width  + unit)
                .attr("height", height + unit);
        // Add a rectangle so we can always see our canvas size
        svg.append("rect")
            .attr("width", "100%")
            .attr("height", "100%")
            .attr("fill", "#faebd7");


        companies = ['Waymo', 'Uber', 'Apple', 'Tesla', 'Glusha']
        for (i = 0; i < companies.length; i++) {
            addCompanyBlock(companies[i]);
        }
        svg.selectAll('g.company')
        .attr("transform", function(d, i) {
          return defaultTranslationForCompany(i)
        });

        startups = ['Otto', 'Argo AI', 'Faraday Futures', 'Clinsense'];
        for (i = 0; i < startups.length; i++) {
            addStartupBlock(startups[i]);
        }
        svg.selectAll('g.startup')
        .attr("transform", function(d, i) {
          return defaultTranslationForStartup(i)
        });

        people = ['Nisha Pathak', "Lucia D'Onofio", "GabeNicholas"];
        for (i = 0; i < people.length; i++) {
            addPersonBlock(people[i]);
        }
        svg.selectAll('g.person')
        .attr("transform", function(d, i) {
          return defaultTranslationForStartup(i)
        });

        /* ANIMATIONS */

        // companies.push("Glusha")
        // addCompanyBlock("Glusha");
        // svg.selectAll('g.company')
        // .transition()
        // .delay(500)
        // .duration(2000)
        // .attr("transform", function(d, i) {
        //   return defaultTranslationForCompany(i)
        // });

        moveBlockToBlock('GabeNicholas', 'Waymo')
        function moveBlockToBlock(moverId, locationId) {
          xy = centerForId(locationId);
          d3.selectAll('g#' + moverId)
            .transition()
            .duration(1000)
            .delay(1000)
            .attr("transform", translateXY(xy[0], xy[1]));
        }

        // Let's draw a path!


        /*
         * PEOPLE METHODS
         */

         function addPersonBlock(name) {
          g = svg.append("g")
              .attr("id", name)
              .attr("class", "person");
          g.append("circle")
             .attr("fill", personColor)
             .attr("r", personRadius + unit)
          g.append("text")
            .attr("text-anchor", "middle")
            .text(name)
            .attr("dy", -personRadius + unit);
         }

        /*                  
         * STARTUP METHODS
         */
         function addStartupBlock(name) {
          g = svg.append("g")
              .attr("id", name)
              .attr("class", "startup");
          g.append("circle")
             .attr("fill", startupColor)
             .attr("r", startupRadius + unit)
          g.append("text")
            .attr("dy", -startupRadius * 1.1 + unit)
            .style("text-anchor", "middle")
            // .style("alignment-baseline", "middle")
            .text(name);
          return g;
         }

         function defaultTranslationForStartup(i) {
            margin = (width - (width * (startups.length - 1))/startups.length) / 2;
            x = (width * i)/startups.length + margin;
            y = 4 * height/5 -startupRadius/2; // Put it 4/5th of the way down
            return translateXY(x, y);
         }

        /*                  
         * COMPANY METHODS
         */

        function addCompanyBlock(name) {
          startX = (width - companyWidth)/2;
          startY = -companyHeight;
          g = svg.append("g")
              .attr("id", name)
              .attr("class", "company")
              .attr("transform", translateXY(startX, startY));

          g.append("rect")
              .attr("fill", companyColor)
              .attr("height", companyHeight + unit)
              .attr("width", companyWidth + unit);
          g.append("text")
              .attr("y", companyHeight/2 + unit)
              .attr("x", companyWidth/2 + unit)
              .attr("text-anchor", "middle")
              .attr("alignment-baseline", "middle")
              .text(name);

          return g;
        };

        function defaultTranslationForCompany(i) {
            margin = (width - (width * (companies.length - 1))/companies.length - companyWidth) / 2; // Used to center
            x = (width * i)/companies.length + margin;
            y = height/5 -companyHeight/2; // Put it 1/5th of the way up
            return translateXY(x, y);
        }

        /*
        * HELPER METHODS
        */
        function translateXY(x, y) {
          return 'translate(' + x + ',' + y + ')';
        }

        function xyTranslate(translate) {
          translate = translate.replace('translate(', '')
          translate = translate.replace(')', '');
          translate = translate.split(',');
          for (var i in translate) {
            translate[i] = +translate[i];
          }
          return translate;
        }

        function centerForId(locationId) {
                    isRect = false;
          d3.select('g#' + locationId)
            .selectAll("rect")
            .each(function() {
              isRect = true;
            })
          translate = d3.select("g#" + locationId)
                        .attr("transform")
          xy = xyTranslate(translate);
          if (isRect) {
            width = d3.select('g#' + locationId)
              .select("rect")
              .attr("width")
            height = d3.select('g#' + locationId)
              .select("rect")
              .attr("height");
            xy[0] = xy[0] + width/2;
            xy[1] = xy[1] + height/2;
          }
          return xy;
        }


        </script>
    </body>
</html>  